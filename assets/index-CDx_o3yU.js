var j=Object.defineProperty;var C=(e,a,s)=>a in e?j(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s;var X=(e,a,s)=>C(e,typeof a!="symbol"?a+"":a,s);import{j as d}from"./jsx-runtime-Cw0GR0a5.js";import{r as x}from"./index-CTjT7uj6.js";import{C as S}from"./index-BAejv6NV.js";import{c as v}from"./createDragHandler-DDNYS428.js";function R(e){return e*180/Math.PI}function b(e){return`matrix(${e.a}, ${e.b}, ${e.c}, ${e.d}, ${e.e}, ${e.f})`}class M{constructor(a,s){X(this,"x");X(this,"y");this.x=a,this.y=s}}function T(e,a,s){const h=Math.cos(s),l=Math.sin(s),o=e.x-a.x,g=e.y-a.y;return new M(o*h-g*l+a.x,o*l+g*h+a.y)}const P=x.forwardRef(function(a,s){return d.jsx("div",{ref:s,style:{position:"absolute",pointerEvents:"none",left:a.x,top:a.y,transform:a.transform},children:d.jsxs("div",{style:{position:"absolute",width:16,height:16,transform:"translate(-50%, -50%)",border:"1px solid var(--cmpui-primary-color)",borderRadius:"50%"},children:[d.jsx("div",{style:{position:"absolute",width:1,height:16,background:"var(--cmpui-primary-color)",left:7.5}}),d.jsx("div",{style:{position:"absolute",width:16,height:1,background:"var(--cmpui-primary-color)",top:7.5}})]})})});P.__docgenInfo={description:"",methods:[],displayName:"OriginMarker"};const i=[[0,0],[0,1],[1,1],[1,0]];function I(e,a,s){return v({onDown(){const h=e.origin.x/e.width,l=e.origin.y/e.height,o=e.width*e.scaleX,g=e.height*e.scaleY,c=new M(a*o-o*h,s*g-g*l),t=new M(a*e.width-e.width*h,s*e.height-e.height*l),n=new M(c.x-t.x,c.y-t.y);return{alreadyMovedDistanceRotated:T(n,{x:0,y:0},e.angle),originToCornerWithoutScale:t}},onMove(h,l,o){var y,f;if(!l)return;const{alreadyMovedDistanceRotated:g,originToCornerWithoutScale:c}=l,t=e.angle;o.dx+=g.x,o.dy+=g.y;const n=o.dx*Math.cos(t)+o.dy*Math.sin(t),r=-o.dx*Math.sin(t)+o.dy*Math.cos(t),u=(n+c.x)/c.x,m=(r+c.y)/c.y;if(a===i[0][0]&&s===i[0][1]||a===i[2][0]&&s===i[2][1]){if(!Number.isFinite(u))return;(y=e.setScaleX)==null||y.call(e,u)}else{if(!Number.isFinite(m))return;(f=e.setScaleY)==null||f.call(e,m)}}})}function q(e,a=0,s=0){return v({onDown(){const h=e.origin.x/e.width,l=e.origin.y/e.height,o=e.width*e.scaleX,g=e.height*e.scaleY,c=new M(a*o-o*h,s*g-g*l),t=new M(a*e.width-e.width*h,s*e.height-e.height*l),n=new M(c.x-t.x,c.y-t.y);return{alreadyMovedDistanceRotated:T(n,{x:0,y:0},e.angle),originToCornerWithoutScale:t}},onMove(h,l,o){var y,f;if(!l)return;const{alreadyMovedDistanceRotated:g,originToCornerWithoutScale:c}=l,t=e.angle;o.dx+=g.x,o.dy+=g.y;const n=o.dx*Math.cos(t)+o.dy*Math.sin(t),r=-o.dx*Math.sin(t)+o.dy*Math.cos(t),u=(n+c.x)/c.x,m=(r+c.y)/c.y;Number.isFinite(u)&&((y=e.setScaleX)==null||y.call(e,u)),Number.isFinite(m)&&((f=e.setScaleY)==null||f.call(e,m))}})}function $(e,a,s,h){return`url(data:image/svg+xml;base64,${e}) ${a} ${s}, ${h}`}function O(e){return`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><defs><filter id="shadow"><feDropShadow dx="0" dy="0" stdDeviation="32" flood-color="black" flood-opacity="1"/></filter></defs><path style="filter:url(#shadow);" transform="rotate(${e} 480 -480)" stroke="white" stroke-width="48" d="M290.74-290.042 100.782-480 290.74-669.958l74.522 74.653-61.739 62.304h352.954l-61.305-62.869 74.088-74.088L859.218-480 669.826-290.607l-74.654-74.088 61.305-62.304H302.958l62.435 62.304-74.653 74.653Z" /></svg>`}function Y(e){return $(btoa(O(R(e))),8,8,"ew-resize")}function z(e){const a=new DOMMatrix().translate(e.position.x,e.position.y).rotate(0,0,R(e.angle)).scale(e.scaleX,e.scaleY).translate(-e.origin.x,-e.origin.y),s=new DOMMatrix().scale(1/e.scaleX,1/e.scaleY),h=b(s),l=x.useMemo(()=>{const t=Math.PI/12;return Math.round(e.angle/t)*t},[e.angle]),o=x.useMemo(()=>[0,0,0,0].map((t,n)=>({cursor:Y(l+Math.PI/4+n*Math.PI/2+(e.scaleX<0?Math.PI/2:0)+(e.scaleY<0?Math.PI/2:0))})),[l,e.scaleX,e.scaleY]),g=x.useMemo(()=>[0,0,0,0].map((t,n)=>({cursor:Y(l+n*Math.PI/2+(e.scaleX<0?Math.PI/2:0)+(e.scaleY<0?Math.PI/2:0))})),[l,e.scaleX,e.scaleY]),c=x.useRef(null);return d.jsxs("div",{style:{position:"absolute",transformOrigin:"top left",left:0,top:0,transform:b(a),width:e.width,height:e.height},...e.rootProps,children:[d.jsx("div",{style:{left:0,height:"100%",boxSizing:"border-box",display:"flex",justifyContent:"center",alignItems:"center"},onPointerDown:v({onMove(t,n,r){var u;(u=e.setPosition)==null||u.call(e,{x:e.position.x+r.dx,y:e.position.y+r.dy})}})}),d.jsx(P,{x:e.origin.x,y:e.origin.y,transform:h,ref:c}),e.showOrigin&&d.jsx("div",{style:{position:"absolute",pointerEvents:"none",left:e.origin.x,top:e.origin.y,transform:h},children:d.jsxs("div",{style:{position:"absolute",width:16,height:16,transform:"translate(-50%, -50%)",border:"1px solid var(--cmpui-primary-color)",borderRadius:"50%"},children:[d.jsx("div",{style:{position:"absolute",width:1,height:16,background:"var(--cmpui-primary-color)",left:7.5}}),d.jsx("div",{style:{position:"absolute",width:16,height:1,background:"var(--cmpui-primary-color)",top:7.5}})]})}),i.map(([t,n],r)=>d.jsxs(x.Fragment,{children:[d.jsx("div",{style:{position:"absolute",left:t===1&&n===0?0:t*e.width,top:t===1&&n===1?0:n*e.height,width:t===i[(r+1)%i.length][0]?1:e.width,height:n===i[(r+1)%i.length][1]?1:e.height,background:"var(--cmpui-primary-color)",transform:b(new DOMMatrix().translate(t===i[(r+1)%i.length][0]?-.5:0,n===i[(r+1)%i.length][1]?-.5:0).scale(t===i[(r+1)%i.length][0]?1/Math.abs(e.scaleX):1,n===i[(r+1)%i.length][1]?1/Math.abs(e.scaleY):1))}}),e.canResize&&d.jsx("div",{style:{position:"absolute",left:t===1&&n===0?0:t*e.width,top:t===1&&n===1?0:n*e.height,width:t===i[(r+1)%i.length][0]?8:e.width,height:n===i[(r+1)%i.length][1]?8:e.height,cursor:g[r].cursor,transform:b(new DOMMatrix().translate(t===i[(r+1)%i.length][0]?-4:0,n===i[(r+1)%i.length][1]?-4:0).scale(t===i[(r+1)%i.length][0]?1/Math.abs(e.scaleX):1,n===i[(r+1)%i.length][1]?1/Math.abs(e.scaleY):1))},onPointerDown:I(e,t,n)})]},r)),e.canRotate&&i.map(([t,n],r)=>d.jsx("div",{style:{transform:b(new DOMMatrix().scale(1/Math.abs(e.scaleX),1/Math.abs(e.scaleY)).translate(t===1?-4:4,n===1?-4:4)),left:t*e.width+(t===1?0:-16),top:n*e.height+(n===1?0:-16),position:"absolute",width:16,height:16,transformOrigin:`${t===0?"right":"left"} ${n===0?"bottom":"top"}`,cursor:[0,0,0,0].map((u,m)=>({cursor:Y(l+-Math.PI/4+m*Math.PI/2+(e.scaleX<0?Math.PI/2:0)+(e.scaleY<0?Math.PI/2:0))}))[r].cursor},onPointerDown:v({onDown(u){const m=c.current;if(!m)return;const y=m.getBoundingClientRect(),f=new M(y.left+y.width/2,y.top+y.height/2),w=new M(u.clientX,u.clientY);return{startX:u.clientX,startY:u.clientY,startAngle:e.angle,globalCenter:f,diffAngle:Math.atan2(f.y-w.y,f.x-w.x)-Math.PI/2}},onMove(u,m){var D;if(!m)return;const y=u.clientX-m.globalCenter.x,f=u.clientY-m.globalCenter.y,w=Math.atan2(f,y)+Math.PI/2;(D=e.onChangeAngle)==null||D.call(e,w-m.diffAngle+m.startAngle)}})},r)),e.canResize&&i.map(([t,n],r)=>d.jsxs(x.Fragment,{children:[d.jsx(S,{x:t*e.width,y:n*e.height,radius:4,fill:"var(--cmpui-primary-color)",style:{transform:h,...o[r]}}),d.jsx("div",{style:{transform:b(new DOMMatrix().scale(1/Math.abs(e.scaleX),1/Math.abs(e.scaleY)).translate(t===1?-4:4,n===1?-4:4)),left:t*e.width+(t===1?0:-8),top:n*e.height+(n===1?0:-8),position:"absolute",width:8,height:8,transformOrigin:`${t===0?"right":"left"} ${n===0?"bottom":"top"}`,...o[r]},onPointerDown:q(e,t,n)})]},r))]})}z.__docgenInfo={description:"",methods:[],displayName:"RectGizmo",props:{width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},scaleX:{required:!0,tsType:{name:"number"},description:""},scaleY:{required:!0,tsType:{name:"number"},description:""},setScaleX:{required:!1,tsType:{name:"signature",type:"function",raw:"(scaleX: number) => void",signature:{arguments:[{type:{name:"number"},name:"scaleX"}],return:{name:"void"}}},description:""},setScaleY:{required:!1,tsType:{name:"signature",type:"function",raw:"(scaleY: number) => void",signature:{arguments:[{type:{name:"number"},name:"scaleY"}],return:{name:"void"}}},description:""},position:{required:!0,tsType:{name:"Vector2"},description:""},setPosition:{required:!1,tsType:{name:"signature",type:"function",raw:"(position: Vector2) => void",signature:{arguments:[{type:{name:"Vector2"},name:"position"}],return:{name:"void"}}},description:""},origin:{required:!0,tsType:{name:"Vector2"},description:""},angle:{required:!0,tsType:{name:"number"},description:""},onChangeAngle:{required:!1,tsType:{name:"signature",type:"function",raw:"(angle: number) => void",signature:{arguments:[{type:{name:"number"},name:"angle"}],return:{name:"void"}}},description:""},rootProps:{required:!1,tsType:{name:"ReactHTMLAttributes",raw:"React.HTMLAttributes<HTMLDivElement>",elements:[{name:"HTMLDivElement"}]},description:""},showOrigin:{required:!1,tsType:{name:"boolean"},description:""},canRotate:{required:!1,tsType:{name:"boolean"},description:""},canResize:{required:!1,tsType:{name:"boolean"},description:""}}};export{z as R,M as V,R as r};
