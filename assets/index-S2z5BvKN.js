var J=Object.defineProperty;var O=(t,e,r)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var z=(t,e,r)=>(O(t,typeof e!="symbol"?e+"":e,r),r);import{j as x}from"./jsx-runtime-DtaoT6pD.js";import{r as g}from"./index-OjgoNOWw.js";import{u as L}from"./useTouchStartPrevent-SoOiKono.js";import{C as X}from"./index-pk5nlV7d.js";import{L as Y}from"./index-cYjXm3u-.js";import{c as $}from"./createDragHandler-nJMxlNVC.js";function Q(t){return t*180/Math.PI}class v{constructor(e,r){z(this,"x");z(this,"y");this.x=e,this.y=r}}function j(t,e,r){const s=Math.cos(r),n=Math.sin(r),u=t.x-e.x,d=t.y-e.y;return new v(u*s-d*n+e.x,u*n+d*s+e.y)}function V(t,e,r){const s=new v(t.x-r.x,t.y-r.y);return s.x*=e.x,s.y*=e.y,new v(r.x+s.x,r.y+s.y)}function S(t,e,r,s){return`url(data:image/svg+xml;base64,${t}) ${e} ${r}, ${s}`}function E(t){return`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><defs><filter id="shadow"><feDropShadow dx="0" dy="0" stdDeviation="32" flood-color="black" flood-opacity="1"/></filter></defs><path style="filter:url(#shadow);" transform="rotate(${t} 480 -480)" stroke="white" stroke-width="48" d="M290.74-290.042 100.782-480 290.74-669.958l74.522 74.653-61.739 62.304h352.954l-61.305-62.869 74.088-74.088L859.218-480 669.826-290.607l-74.654-74.088 61.305-62.304H302.958l62.435 62.304-74.653 74.653Z" /></svg>`}function G(t){return S(btoa(E(Q(t))),8,8,"ew-resize")}function B({nobRadius:t=10,...e}){const r=L(),s=$({onDown:i=>{var a;return i.stopPropagation(),(a=e.onStart)==null||a.call(e),{startX:i.clientX,startY:i.clientY,startAngle:e.angle}},onMove:(i,a)=>{if(!a)return;const c=a.startAngle+Math.PI/2,M=new v(a.startX+Math.cos(c)*e.length,a.startY+Math.sin(c)*e.length),p=i.clientX-M.x,y=i.clientY-M.y,m=Math.atan2(y,p)+Math.PI/2;e.onChange(m)},onUp:e.onEnd}),n=j(new v(e.x,e.y-e.length),{x:e.x,y:e.y},e.angle),u=j(new v(e.x,e.y-e.startLength),{x:e.x,y:e.y},e.angle),d=g.useMemo(()=>{const i=Math.PI/12;return Math.round(e.angle/i)*i},[e.angle]),b=g.useMemo(()=>({cursor:G(d)}),[d]);return x.jsxs(x.Fragment,{children:[x.jsx(X,{ref:r,x:n.x,y:n.y,radius:t,onPointerDown:s,fill:"var(--cmpui-primary-color)",style:b}),x.jsx(Y,{x1:u.x,y1:u.y,x2:n.x,y2:n.y,strokeWidth:1,stroke:"var(--cmpui-primary-color)"})]})}B.__docgenInfo={description:"",methods:[],displayName:"AngleNob",props:{angle:{required:!0,tsType:{name:"number"},description:""},length:{required:!0,tsType:{name:"number"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(angle: number) => void",signature:{arguments:[{type:{name:"number"},name:"angle"}],return:{name:"void"}}},description:""},startLength:{required:!0,tsType:{name:"number"},description:""},x:{required:!0,tsType:{name:"number"},description:""},y:{required:!0,tsType:{name:"number"},description:""},nobRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"10",computed:!1}},onEnd:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onStart:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};function K({angle:t,height:e,onMove:r,width:s,x:n,y:u,onEnd:d,onStart:b}){const i=s<0?-s:s,a=e<0?-e:e,c=(s<0,n-i/2),M=(e<0,u-a/2),p=g.useMemo(()=>$({onDown(m){m.stopPropagation(),b==null||b()},onMove:(m,o,{dx:f,dy:P})=>{r({x:n+f,y:u+P}),m.preventDefault()},onUp:d}),[r,n,u,d,b]),y=L();return x.jsx("svg",{ref:y,viewBox:`0 0 ${i} ${a}`,style:{position:"absolute",width:i,height:a,transform:`rotate(${t}rad)`,top:M,left:c},className:"cmpui-rect-gizmo--movable-rect",onPointerDown:p,children:x.jsx("rect",{x:0,y:0,width:i,height:a,fill:"transparent"})})}K.__docgenInfo={description:"",methods:[],displayName:"MovableRect",props:{angle:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},onMove:{required:!0,tsType:{name:"signature",type:"function",raw:"(args: { x?: number; y?: number }) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:"{ x?: number; y?: number }",signature:{properties:[{key:"x",value:{name:"number",required:!1}},{key:"y",value:{name:"number",required:!1}}]}},name:"args"}],return:{name:"void"}}},description:""},width:{required:!0,tsType:{name:"number"},description:""},x:{required:!0,tsType:{name:"number"},description:""},y:{required:!0,tsType:{name:"number"},description:""},onEnd:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onStart:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const W={"left-top":[-1,-1],"right-top":[1,-1],"left-bottom":[-1,1],"right-bottom":[1,1]};function U(t,e,r){const s=Math.abs(e),n=Math.abs(t);if(Math.abs(s/n)>r)return{width:s/r*Math.sign(t),height:s*Math.sign(e)};const d=n*r;return{width:n*Math.sign(t),height:d*Math.sign(e)}}const A={"left-top":[-1,-1,1,-1],"right-top":[1,1,1,-1],"left-bottom":[-1,-1,-1,1],"right-bottom":[1,1,-1,1]};function _(t,e,r,s,n,u,d,b,i){let a=0,c=0;const M=()=>{const m=A[d][0]*a*Math.cos(n)+A[d][1]*c*Math.sin(n);return r+m*2},p=()=>{const m=A[d][2]*a*Math.sin(n)+A[d][3]*c*Math.cos(n);return s+m*2},y=new v((t.x+e.x)/2,(t.y+e.y)/2);return $({onDown:m=>{m.stopPropagation();const o=Math.abs(s/r),f=q=>{const k=U(M(),p(),o);u({x:y.x,y:y.y,...k})},P=()=>{u({x:y.x,y:y.y,width:M(),height:p()})};return window.addEventListener("keydown",f),window.addEventListener("keyup",P),i==null||i(),{startP2:e,startRatio:o,startP1:t,startWidth:r,startHeight:s,startCenter:y,cleanUp(){window.removeEventListener("keydown",f),window.removeEventListener("keyup",P)}}},onMove:(m,o,{dx:f,dy:P})=>{if(!o)return;a=f,c=P;const q=o.startCenter,k=new v(q.x-o.startP1.x,q.y-o.startP1.y),R=new v(q.x-(o.startP1.x+a),q.y-(o.startP1.y+c)),h=new v(R.x/k.x,R.y/k.y);(Number.isNaN(h.x)||h.x===1/0||h.x===-1/0)&&(a=0),(Number.isNaN(h.y)||h.y===1/0||h.y===-1/0)&&(c=0);const H=new v(o.startP1.x+a,o.startP1.y+c),I=V(o.startP2,h,q),N=V(o.startCenter,h,q),D=j(H,N,-n),l=j(I,N,-n);let w=l.x-D.x,T=l.y-D.y;if(w*=-W[d][0],T*=-W[d][1],m.shiftKey){const C=U(M(),p(),o.startRatio);u({x:o.startCenter.x,y:o.startCenter.y,...C})}else u({width:w,height:T,x:N.x,y:N.y})},onUp:(m,o)=>{o&&(o.cleanUp(),b==null||b())}})}const ee=["left-top","right-top","right-bottom","left-bottom"];function te({width:t,height:e,x:r,y:s,angle:n,onMove:u,isRotatable:d=!1,isResizable:b=!1,nobRadius:i=6,onEnd:a,onStart:c}){const M=g.useMemo(()=>new v(r,s),[r,s]),[p,y,m,o]=g.useMemo(()=>ee.map(l=>{const[w,T]=W[l],C=new v(r+w*t/2,s+T*e/2);return j(C,M,n)}),[n,M,e,t,r,s]),f=g.useCallback(l=>{u({x:l.x,y:l.y,width:l.width,height:l.height,angle:n})},[u,n]),P=g.useMemo(()=>_(p,m,t,e,n,f,"left-top",a,c),[p,m,t,e,n,f,a,c]),q=g.useMemo(()=>_(y,o,t,e,n,f,"right-top",a,c),[y,o,t,e,n,f,a,c]),k=g.useMemo(()=>_(o,y,t,e,n,f,"left-bottom",a,c),[o,y,t,e,n,f,a,c]),R=g.useMemo(()=>_(m,p,t,e,n,f,"right-bottom",a,c),[p,m,t,e,n,f,a,c]),h=g.useMemo(()=>[[p.x,p.y],[y.x,y.y],[m.x,m.y],[o.x,o.y]],[p,y,m,o]),H=g.useMemo(()=>[P,q,R,k],[P,q,R,k]),I=g.useMemo(()=>{const l=Math.PI/12;return Math.round(n/l)*l},[n]),N=g.useMemo(()=>[0,0,0,0].map((l,w)=>({cursor:G(I+Math.PI/4+w*Math.PI/2+(t<0?Math.PI/2:0)+(e<0?Math.PI/2:0))})),[I,t,e]),D=g.useCallback(l=>{u({x:r,y:s,width:t,height:e,angle:l})},[u,r,s,t,e]);return x.jsxs(x.Fragment,{children:[x.jsx(K,{width:t,height:e,x:r,y:s,angle:n,onMove:u,onEnd:a,onStart:c}),h.map((l,w)=>{const[T,C]=l,[F,Z]=h[w+1]??h[0];return x.jsx(Y,{x1:T,y1:C,x2:F,y2:Z,strokeWidth:1,stroke:"var(--cmpui-primary-color)"},w)}),b&&H.map((l,w)=>{const[T,C]=h[w];return x.jsx(ne,{x:T,y:C,radius:i,fill:"var(--cmpui-primary-color)",onPointerDown:l,style:N[w]},w)}),d&&x.jsx(B,{x:r,y:s,angle:n,nobRadius:i,startLength:Math.abs(e/2),length:Math.abs(e)/2+i*2,onChange:D,onEnd:a,onStart:c})]})}function ne(t){const e=L();return x.jsx(X,{ref:e,...t})}te.__docgenInfo={description:"",methods:[],displayName:"RectGizmo",props:{width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},x:{required:!0,tsType:{name:"number"},description:""},y:{required:!0,tsType:{name:"number"},description:""},angle:{required:!0,tsType:{name:"number"},description:""},nobRadius:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"6",computed:!1}},isRotatable:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isResizable:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onMove:{required:!0,tsType:{name:"signature",type:"function",raw:`(args: {
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  angle?: number;
}) => void`,signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  x?: number;
  y?: number;
  width?: number;
  height?: number;
  angle?: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!1}},{key:"y",value:{name:"number",required:!1}},{key:"width",value:{name:"number",required:!1}},{key:"height",value:{name:"number",required:!1}},{key:"angle",value:{name:"number",required:!1}}]}},name:"args"}],return:{name:"void"}}},description:""},onEnd:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onStart:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};export{te as R,Q as r};
