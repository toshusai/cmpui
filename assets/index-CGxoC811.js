import{j as Y}from"./jsx-runtime-Cw0GR0a5.js";import{r as p}from"./index-CTjT7uj6.js";function T({onDown:n,onMove:a,onUp:i,options:t}){return r=>{if(r.button!==0)return;const s=r.currentTarget;if(!(s instanceof HTMLElement))return;const l=n==null?void 0:n(r);let e;const c=t!=null&&t.pointerMoveOnWindow?window:s,v=u=>{u instanceof PointerEvent&&l!==!1&&(u.preventDefault(),a==null||a(u,l,{dx:u.clientX-r.clientX,dy:u.clientY-r.clientY,deltaX:u.clientX-((e==null?void 0:e.clientX)??r.clientX),deltaY:u.clientY-((e==null?void 0:e.clientY)??r.clientY)}),e=u)},o=u=>{u instanceof PointerEvent&&l!==!1&&(c.removeEventListener("pointermove",v),window.removeEventListener("pointerup",o),(t==null?void 0:t.disableCapture)!==!0&&s.releasePointerCapture(u.pointerId),i==null||i(u,l,e))};l!==!1&&((t==null?void 0:t.disableCapture)!==!0&&s.setPointerCapture(r.pointerId),c.addEventListener("pointermove",v,{passive:!1}),window.addEventListener("pointerup",o))}}function x(n,a,i,t,r,s){var l;const{view:e,maxScale:c,minScale:v}=r;let o=1+t/200;const u=n.getBoundingClientRect();if(!((l=n.parentElement)!=null&&l.getBoundingClientRect()))return;const g=a-u.left,d=i-u.top,b=g-e.x,f=d-e.y;c!==void 0&&e.scale*o>c?o=c/e.scale:v!==void 0&&e.scale*o<v&&(o=v/e.scale),s({x:e.x+b-b*o,y:e.y+f-f*o,scale:e.scale*o})}const y={Auto:"auto",Grab:"grab",Grabbing:"grabbing",ZoomIn:"zoom-in",ZoomOut:"zoom-out"};function w(n,a,i,t){return T({onDown:r=>n.style.cursor!==y.Grab?!1:(t==null||t(y.Grabbing),{startX:r.clientX,startY:r.clientY,startOSX:a.x,startOSY:a.y}),onMove:(r,s)=>{if(s===void 0)return;const l=s.startX-r.clientX,e=s.startY-r.clientY;i({x:s.startOSX-l,y:s.startOSY-e,scale:a.scale})},onUp:()=>{n.style.cursor===y.Grabbing?t==null||t(y.Grab):t==null||t(y.Auto)}})}const M={trackPadMoveScaleX:1,trackPadMoveScaleY:1};function R(n,a,i,t,r){if(n.shiftKey)return;const s={...M,...r},l=Number.isInteger(n.deltaY),e=n.ctrlKey||n.metaKey;if(l&&!e){i({x:a.x-n.deltaX*s.trackPadMoveScaleX,y:a.y-n.deltaY*s.trackPadMoveScaleY,scale:a.scale}),n.preventDefault();return}t(n.clientX,n.clientY,-n.deltaY),n.preventDefault()}function S(n,a,i,t){p.useEffect(()=>{if(n.current!==null)return n.current.addEventListener(a,i,t),()=>{n.current!==null&&n.current.removeEventListener(a,i)}},[t,i,a,n])}function P({trackPadMoveScaleX:n=1,trackPadMoveScaleY:a=1,pointerDownZoomScale:i=100,minScale:t,maxScale:r,children:s,content:l,view:e,cursor:c,setCursor:v,onChangeView:o,style:u,...g}){const d=p.useRef(null),b=p.useCallback((m,k,C)=>{d.current&&x(d.current,m,k,C,{view:e,maxScale:r,minScale:t},o)},[d.current,e,r,t,o]);S(d,"wheel",p.useCallback(m=>{R(m,e,o,b,{trackPadMoveScaleX:n,trackPadMoveScaleY:a})},[e,o,x,a,n]),p.useMemo(()=>({passive:!1}),[]));const f=p.useMemo(()=>{if(d.current)return w(d.current,e,o,v)},[e,o,d.current]),X=p.useCallback(m=>{c===y.ZoomIn?b(m.pageX,m.pageY,i):c===y.ZoomOut?b(m.pageX,m.pageY,-i):f==null||f(m.nativeEvent)},[f,i,x,c]),q=p.useMemo(()=>({position:"absolute",pointerEvents:"none",transformOrigin:"0 0",top:`${e.y}px`,left:`${e.x}px`,transform:`scale(${e.scale})`}),[e.x,e.y,e.scale]),E=p.useMemo(()=>({cursor:c,...u}),[c,u]);return Y.jsxs("div",{className:"cmpui_canvas-view__root",tabIndex:-1,ref:d,onPointerDown:X,style:E,...g,children:[Y.jsx("div",{style:q,children:l}),s]})}P.__docgenInfo={description:"",methods:[],displayName:"CanvasView",props:{children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},content:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},onChangeView:{required:!0,tsType:{name:"signature",type:"function",raw:"(view: View) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
  scale: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}},{key:"scale",value:{name:"number",required:!0}}]}},name:"view"}],return:{name:"void"}}},description:""},view:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
  scale: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}},{key:"scale",value:{name:"number",required:!0}}]}},description:""},cursor:{required:!1,tsType:{name:"CanvasViewCursor"},description:""},setCursor:{required:!1,tsType:{name:"signature",type:"function",raw:"(cursor: CanvasViewCursor) => void",signature:{arguments:[{type:{name:"CanvasViewCursor"},name:"cursor"}],return:{name:"void"}}},description:""},minScale:{required:!1,tsType:{name:"number"},description:""},maxScale:{required:!1,tsType:{name:"number"},description:""},trackPadZoomScale:{required:!1,tsType:{name:"number"},description:""},trackPadMoveScaleX:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},trackPadMoveScaleY:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},pointerDownZoomScale:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"100",computed:!1}}}};export{P as C,y as s};
