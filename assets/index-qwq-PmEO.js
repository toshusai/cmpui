var j=Object.defineProperty;var S=(e,r,s)=>r in e?j(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s;var v=(e,r,s)=>(S(e,typeof r!="symbol"?r+"":r,s),s);import{j as l}from"./jsx-runtime-DvLKfCe6.js";import{r as b}from"./index-aXz8NaAs.js";import{c as w}from"./createDragHandler-nJMxlNVC.js";import{C as q}from"./index-0ceNsg1m.js";function D(e){return e*180/Math.PI}class y{constructor(r,s){v(this,"x");v(this,"y");this.x=r,this.y=s}}function T(e,r,s){const u=Math.cos(s),c=Math.sin(s),o=e.x-r.x,h=e.y-r.y;return new y(o*u-h*c+r.x,o*c+h*u+r.y)}function M(e){return`matrix(${e.a}, ${e.b}, ${e.c}, ${e.d}, ${e.e}, ${e.f})`}function R(e){return l.jsx("div",{style:{position:"absolute",pointerEvents:"none",left:e.x,top:e.y,transform:e.transform},children:l.jsxs("div",{style:{position:"absolute",width:16,height:16,transform:"translate(-50%, -50%)",border:"1px solid var(--cmpui-primary-color)",borderRadius:"50%"},children:[l.jsx("div",{style:{position:"absolute",width:1,height:16,background:"var(--cmpui-primary-color)",left:7.5}}),l.jsx("div",{style:{position:"absolute",width:16,height:1,background:"var(--cmpui-primary-color)",top:7.5}})]})})}R.__docgenInfo={description:"",methods:[],displayName:"OriginMarker",props:{x:{required:!0,tsType:{name:"number"},description:""},y:{required:!0,tsType:{name:"number"},description:""},transform:{required:!0,tsType:{name:"string"},description:""}}};const a=[[0,0],[0,1],[1,1],[1,0]];function C(e,r,s){return w({onDown(){const u=e.origin.x/e.width,c=e.origin.y/e.height,o=e.width*e.scaleX,h=e.height*e.scaleY,n=new y(r*o-o*u,s*h-h*c),t=new y(r*e.width-e.width*u,s*e.height-e.height*c),i=new y(n.x-t.x,n.y-t.y);return{alreadyMovedDistanceRotated:T(i,{x:0,y:0},e.angle),originToCornerWithoutScale:t}},onMove(u,c,o){var f,x;if(!c)return;const{alreadyMovedDistanceRotated:h,originToCornerWithoutScale:n}=c,t=e.angle;o.dx+=h.x,o.dy+=h.y;const i=o.dx*Math.cos(t)+o.dy*Math.sin(t),d=-o.dx*Math.sin(t)+o.dy*Math.cos(t),g=(i+n.x)/n.x,m=(d+n.y)/n.y;if(r===a[0][0]&&s===a[0][1]||r===a[2][0]&&s===a[2][1]){if(!Number.isFinite(g))return;(f=e.setScaleX)==null||f.call(e,g)}else{if(!Number.isFinite(m))return;(x=e.setScaleY)==null||x.call(e,m)}}})}function I(e,r=0,s=0){return w({onDown(){const u=e.origin.x/e.width,c=e.origin.y/e.height,o=e.width*e.scaleX,h=e.height*e.scaleY,n=new y(r*o-o*u,s*h-h*c),t=new y(r*e.width-e.width*u,s*e.height-e.height*c),i=new y(n.x-t.x,n.y-t.y);return{alreadyMovedDistanceRotated:T(i,{x:0,y:0},e.angle),originToCornerWithoutScale:t}},onMove(u,c,o){var f,x;if(!c)return;const{alreadyMovedDistanceRotated:h,originToCornerWithoutScale:n}=c,t=e.angle;o.dx+=h.x,o.dy+=h.y;const i=o.dx*Math.cos(t)+o.dy*Math.sin(t),d=-o.dx*Math.sin(t)+o.dy*Math.cos(t),g=(i+n.x)/n.x,m=(d+n.y)/n.y;Number.isFinite(g)&&((f=e.setScaleX)==null||f.call(e,g)),Number.isFinite(m)&&((x=e.setScaleY)==null||x.call(e,m))}})}function $(e,r,s,u){return`url(data:image/svg+xml;base64,${e}) ${r} ${s}, ${u}`}function O(e){return`<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><defs><filter id="shadow"><feDropShadow dx="0" dy="0" stdDeviation="32" flood-color="black" flood-opacity="1"/></filter></defs><path style="filter:url(#shadow);" transform="rotate(${e} 480 -480)" stroke="white" stroke-width="48" d="M290.74-290.042 100.782-480 290.74-669.958l74.522 74.653-61.739 62.304h352.954l-61.305-62.869 74.088-74.088L859.218-480 669.826-290.607l-74.654-74.088 61.305-62.304H302.958l62.435 62.304-74.653 74.653Z" /></svg>`}function X(e){return $(btoa(O(D(e))),8,8,"ew-resize")}function z(e){const r=new DOMMatrix().translate(e.position.x,e.position.y).rotate(0,0,D(e.angle)).scale(e.scaleX,e.scaleY).translate(-e.origin.x,-e.origin.y),s=new DOMMatrix().scale(1/e.scaleX,1/e.scaleY),u=M(s),c=b.useMemo(()=>{const n=Math.PI/12;return Math.round(e.angle/n)*n},[e.angle]),o=b.useMemo(()=>[0,0,0,0].map((n,t)=>({cursor:X(c+Math.PI/4+t*Math.PI/2+(e.scaleX<0?Math.PI/2:0)+(e.scaleY<0?Math.PI/2:0))})),[c,e.scaleX,e.scaleY]),h=b.useMemo(()=>[0,0,0,0].map((n,t)=>({cursor:X(c+t*Math.PI/2+(e.scaleX<0?Math.PI/2:0)+(e.scaleY<0?Math.PI/2:0))})),[c,e.scaleX,e.scaleY]);return l.jsxs("div",{style:{position:"absolute",transformOrigin:"top left",left:0,top:0,transform:M(r),width:e.width,height:e.height},...e.rootProps,children:[l.jsx("div",{style:{left:0,height:"100%",boxSizing:"border-box",display:"flex",justifyContent:"center",alignItems:"center"},onPointerDown:w({onMove(n,t,i){var d;(d=e.setPosition)==null||d.call(e,{x:e.position.x+i.dx,y:e.position.y+i.dy})}})}),l.jsx(R,{x:e.origin.x,y:e.origin.y,transform:u}),e.showOrigin&&l.jsx("div",{style:{position:"absolute",pointerEvents:"none",left:e.origin.x,top:e.origin.y,transform:u},children:l.jsxs("div",{style:{position:"absolute",width:16,height:16,transform:"translate(-50%, -50%)",border:"1px solid var(--cmpui-primary-color)",borderRadius:"50%"},children:[l.jsx("div",{style:{position:"absolute",width:1,height:16,background:"var(--cmpui-primary-color)",left:7.5}}),l.jsx("div",{style:{position:"absolute",width:16,height:1,background:"var(--cmpui-primary-color)",top:7.5}})]})}),a.map(([n,t],i)=>l.jsxs(b.Fragment,{children:[l.jsx("div",{style:{position:"absolute",left:n===1&&t===0?0:n*e.width,top:n===1&&t===1?0:t*e.height,width:n===a[(i+1)%a.length][0]?1:e.width,height:t===a[(i+1)%a.length][1]?1:e.height,background:"var(--cmpui-primary-color)",transform:M(new DOMMatrix().translate(n===a[(i+1)%a.length][0]?-.5:0,t===a[(i+1)%a.length][1]?-.5:0).scale(n===a[(i+1)%a.length][0]?1/Math.abs(e.scaleX):1,t===a[(i+1)%a.length][1]?1/Math.abs(e.scaleY):1))}}),e.canResize&&l.jsx("div",{style:{position:"absolute",left:n===1&&t===0?0:n*e.width,top:n===1&&t===1?0:t*e.height,width:n===a[(i+1)%a.length][0]?8:e.width,height:t===a[(i+1)%a.length][1]?8:e.height,cursor:h[i].cursor,transform:M(new DOMMatrix().translate(n===a[(i+1)%a.length][0]?-4:0,t===a[(i+1)%a.length][1]?-4:0).scale(n===a[(i+1)%a.length][0]?1/Math.abs(e.scaleX):1,t===a[(i+1)%a.length][1]?1/Math.abs(e.scaleY):1))},onPointerDown:C(e,n,t)})]},i)),e.canRotate&&a.map(([n,t],i)=>l.jsx("div",{style:{transform:M(new DOMMatrix().scale(1/Math.abs(e.scaleX),1/Math.abs(e.scaleY)).translate(n===1?-4:4,t===1?-4:4)),left:n*e.width+(n===1?0:-16),top:t*e.height+(t===1?0:-16),position:"absolute",width:16,height:16,transformOrigin:`${n===0?"right":"left"} ${t===0?"bottom":"top"}`,cursor:[0,0,0,0].map((d,g)=>({cursor:X(c+-Math.PI/4+g*Math.PI/2+(e.scaleX<0?Math.PI/2:0)+(e.scaleY<0?Math.PI/2:0))}))[i].cursor},onPointerDown:w({onDown(d){const g=new y(e.position.x,e.position.y),m=new y(d.clientX,d.clientY);return{startX:d.clientX,startY:d.clientY,startAngle:e.angle,diffAngle:Math.atan2(g.y-m.y,g.x-m.x)-Math.PI/2}},onMove(d,g){var Y;if(!g)return;const m=new y(e.position.x,e.position.y),f=d.clientX-m.x,x=d.clientY-m.y,P=Math.atan2(x,f)+Math.PI/2;(Y=e.onChangeAngle)==null||Y.call(e,P-g.diffAngle+g.startAngle)}})},i)),e.canResize&&a.map(([n,t],i)=>l.jsxs(b.Fragment,{children:[l.jsx(q,{x:n*e.width,y:t*e.height,radius:4,fill:"var(--cmpui-primary-color)",style:{transform:u,...o[i]}}),l.jsx("div",{style:{transform:M(new DOMMatrix().scale(1/Math.abs(e.scaleX),1/Math.abs(e.scaleY)).translate(n===1?-4:4,t===1?-4:4)),left:n*e.width+(n===1?0:-8),top:t*e.height+(t===1?0:-8),position:"absolute",width:8,height:8,transformOrigin:`${n===0?"right":"left"} ${t===0?"bottom":"top"}`,...o[i]},onPointerDown:I(e,n,t)})]},i))]})}z.__docgenInfo={description:"",methods:[],displayName:"RectGizmo",props:{width:{required:!0,tsType:{name:"number"},description:""},height:{required:!0,tsType:{name:"number"},description:""},scaleX:{required:!0,tsType:{name:"number"},description:""},scaleY:{required:!0,tsType:{name:"number"},description:""},setScaleX:{required:!1,tsType:{name:"signature",type:"function",raw:"(scaleX: number) => void",signature:{arguments:[{type:{name:"number"},name:"scaleX"}],return:{name:"void"}}},description:""},setScaleY:{required:!1,tsType:{name:"signature",type:"function",raw:"(scaleY: number) => void",signature:{arguments:[{type:{name:"number"},name:"scaleY"}],return:{name:"void"}}},description:""},position:{required:!0,tsType:{name:"Vector2"},description:""},setPosition:{required:!1,tsType:{name:"signature",type:"function",raw:"(position: Vector2) => void",signature:{arguments:[{type:{name:"Vector2"},name:"position"}],return:{name:"void"}}},description:""},origin:{required:!0,tsType:{name:"Vector2"},description:""},angle:{required:!0,tsType:{name:"number"},description:""},onChangeAngle:{required:!1,tsType:{name:"signature",type:"function",raw:"(angle: number) => void",signature:{arguments:[{type:{name:"number"},name:"angle"}],return:{name:"void"}}},description:""},rootProps:{required:!1,tsType:{name:"ReactHTMLAttributes",raw:"React.HTMLAttributes<HTMLDivElement>",elements:[{name:"HTMLDivElement"}]},description:""},showOrigin:{required:!1,tsType:{name:"boolean"},description:""},canRotate:{required:!1,tsType:{name:"boolean"},description:""},canResize:{required:!1,tsType:{name:"boolean"},description:""}}};export{z as R,y as V,D as r};
