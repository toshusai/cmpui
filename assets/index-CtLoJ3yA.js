import{j as E}from"./jsx-runtime-Cw0GR0a5.js";import{r as p}from"./index-CTjT7uj6.js";function S({onDown:e,onMove:t,onUp:a,options:n}){return o=>{if(o.button!==0)return;const i=o.currentTarget;if(!(i instanceof HTMLElement))return;const u=e==null?void 0:e(o);let r;const c=n!=null&&n.pointerMoveOnWindow?window:i,f=s=>{s instanceof PointerEvent&&u!==!1&&(s.preventDefault(),t==null||t(s,u,{dx:s.clientX-o.clientX,dy:s.clientY-o.clientY,deltaX:s.clientX-((r==null?void 0:r.clientX)??o.clientX),deltaY:s.clientY-((r==null?void 0:r.clientY)??o.clientY)}),r=s)},l=s=>{s instanceof PointerEvent&&u!==!1&&(c.removeEventListener("pointermove",f),window.removeEventListener("pointerup",l),(n==null?void 0:n.disableCapture)!==!0&&i.releasePointerCapture(s.pointerId),a==null||a(s,u,r))};u!==!1&&((n==null?void 0:n.disableCapture)!==!0&&i.setPointerCapture(o.pointerId),c.addEventListener("pointermove",f,{passive:!1}),window.addEventListener("pointerup",l))}}const v={Auto:"auto",Grab:"grab",Grabbing:"grabbing",ZoomIn:"zoom-in",ZoomOut:"zoom-out"};function X(e,t,a,n){return S({onDown:o=>e.style.cursor!==v.Grab?!1:(n==null||n(v.Grabbing),{startX:o.clientX,startY:o.clientY,startOSX:t.x,startOSY:t.y}),onMove:(o,i)=>{if(i===void 0)return;const u=i.startX-o.clientX,r=i.startY-o.clientY;a({x:i.startOSX-u,y:i.startOSY-r,scale:t.scale})},onUp:()=>{e.style.cursor===v.Grabbing?n==null||n(v.Grab):n==null||n(v.Auto)}})}const M={trackPadMoveScaleX:1,trackPadMoveScaleY:1};function C(e,t,a,n,o){if(e.shiftKey)return;const i={...M,...o},u=Number.isInteger(e.deltaY),r=e.ctrlKey||e.metaKey;if(u&&!r){a({x:t.x-e.deltaX*i.trackPadMoveScaleX,y:t.y-e.deltaY*i.trackPadMoveScaleY,scale:t.scale}),e.preventDefault();return}n(e.clientX,e.clientY,-e.deltaY),e.preventDefault()}function g(e,t,a,n,o,i){var u;const{view:r,maxScale:c,minScale:f}=o;let l=1+n/200;const s=e.getBoundingClientRect();if(!((u=e.parentElement)!=null&&u.getBoundingClientRect()))return;const x=t-s.left,d=a-s.top,y=x-r.x,b=d-r.y;c!==void 0&&r.scale*l>c?l=c/r.scale:f!==void 0&&r.scale*l<f&&(l=f/r.scale),i({x:r.x+y-y*l,y:r.y+b-b*l,scale:r.scale*l})}function A(e){var t;const a=Array.from(((t=document.body)==null?void 0:t.children)??[]).filter(n=>n!==e);return a.forEach(n=>{n.setAttribute("aria-hidden","true")}),()=>{a.forEach(n=>{n.removeAttribute("aria-hidden")})}}const h=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'];function D(e){let t=[...e.querySelectorAll(h.join(", "))].filter(u=>u instanceof HTMLElement);const a=document.activeElement,n=new MutationObserver(()=>{t=[...e.querySelectorAll(h.join(", "))].filter(u=>u instanceof HTMLElement)});n.observe(e,{attributes:!0,childList:!0,subtree:!0});const o=u=>{u.key==="Tab"&&(u.shiftKey?document.activeElement===t[0]&&(u.preventDefault(),t[t.length-1].focus()):document.activeElement===t[t.length-1]&&(u.preventDefault(),t[0].focus()))},i=t.find(u=>u.autofocus);return i?i.focus():t.length>0&&t[0].focus(),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),n.disconnect(),a instanceof HTMLElement&&a.focus()}}function L(){return window.innerWidth-document.documentElement.clientWidth}const I=()=>{if(document.body.dataset.lockScroll)return()=>{};const e=document.documentElement.scrollLeft,t=document.documentElement.scrollTop,a={overflow:"hidden",position:"fixed",top:`${-t}px`,left:`${-e}px`,width:"100%",height:"100%",boxSizing:"border-box",paddingRight:`${L()}px`},n=Object.keys(a).reduce((o,i)=>(o[i]=document.body.style[i],o),{});return Object.entries(a).forEach(([o,i])=>{document.body.style[o]=i}),document.body.dataset.lockScroll="true",()=>{Object.keys(a).forEach(o=>{document.body.style[o]=n[o]}),delete document.body.dataset.lockScroll,window.scrollTo(e,t)}};function O(e,t,a,n){p.useEffect(()=>{if(e.current!==null)return e.current.addEventListener(t,a,n),()=>{e.current!==null&&e.current.removeEventListener(t,a)}},[n,a,t,e])}function R({trackPadMoveScaleX:e=1,trackPadMoveScaleY:t=1,pointerDownZoomScale:a=100,minScale:n,maxScale:o,children:i,content:u,view:r,cursor:c,setCursor:f,onChangeView:l,style:s,...x}){const d=p.useRef(null),y=p.useCallback((m,T,Y)=>{d.current&&g(d.current,m,T,Y,{view:r,maxScale:o,minScale:n},l)},[d.current,r,o,n,l]);O(d,"wheel",p.useCallback(m=>{C(m,r,l,y,{trackPadMoveScaleX:e,trackPadMoveScaleY:t})},[r,l,g,t,e]),p.useMemo(()=>({passive:!1}),[]));const b=p.useMemo(()=>{if(d.current)return X(d.current,r,l,f)},[r,l,d.current]),w=p.useCallback(m=>{c===v.ZoomIn?y(m.pageX,m.pageY,a):c===v.ZoomOut?y(m.pageX,m.pageY,-a):b==null||b(m.nativeEvent)},[b,a,g,c]),k=p.useMemo(()=>({position:"absolute",pointerEvents:"none",transformOrigin:"0 0",top:`${r.y}px`,left:`${r.x}px`,transform:`scale(${r.scale})`}),[r.x,r.y,r.scale]),q=p.useMemo(()=>({cursor:c,...s}),[c,s]);return E.jsxs("div",{className:"cmpui_canvas-view__root",tabIndex:-1,ref:d,onPointerDown:w,style:q,...x,children:[E.jsx("div",{style:k,children:u}),i]})}R.__docgenInfo={description:"",methods:[],displayName:"CanvasView",props:{children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},content:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},onChangeView:{required:!0,tsType:{name:"signature",type:"function",raw:"(view: View) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
  scale: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}},{key:"scale",value:{name:"number",required:!0}}]}},name:"view"}],return:{name:"void"}}},description:""},view:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  x: number;
  y: number;
  scale: number;
}`,signature:{properties:[{key:"x",value:{name:"number",required:!0}},{key:"y",value:{name:"number",required:!0}},{key:"scale",value:{name:"number",required:!0}}]}},description:""},cursor:{required:!1,tsType:{name:"CanvasViewCursor"},description:""},setCursor:{required:!1,tsType:{name:"signature",type:"function",raw:"(cursor: CanvasViewCursor) => void",signature:{arguments:[{type:{name:"CanvasViewCursor"},name:"cursor"}],return:{name:"void"}}},description:""},minScale:{required:!1,tsType:{name:"number"},description:""},maxScale:{required:!1,tsType:{name:"number"},description:""},trackPadZoomScale:{required:!1,tsType:{name:"number"},description:""},trackPadMoveScaleX:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},trackPadMoveScaleY:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},pointerDownZoomScale:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"100",computed:!1}}}};export{R as C,I as M,D as P,v as Q,A as a};
