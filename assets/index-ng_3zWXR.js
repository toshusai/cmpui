import{j as c}from"./jsx-runtime-DtaoT6pD.js";import{F as H}from"./index-hC_OXdTA.js";import{L as U}from"./index-14PbI9Yx.js";import{_ as $}from"./index-Eok78svH.js";import{r as t}from"./index-OjgoNOWw.js";import{$ as B,f as F,a as V,c as I}from"./index-wq2dZbDE.js";import{$ as S,a as Y,b as X,e as W,c as z,d as G,f as J}from"./index--q_WrUwI.js";import{r as K}from"./index-mQqIOHEI.js";function Q({onDown:e,onMove:r,onUp:n}){return a=>{if(a.buttons===2)return;const d=e==null?void 0:e(a);let i;const s=m=>{i=r==null?void 0:r(m,d,i)},u=m=>{window.removeEventListener("pointermove",s),window.removeEventListener("pointerup",u),n==null||n(m,d,i)};window.addEventListener("pointermove",s),window.addEventListener("pointerup",u)}}const j="ContextMenu",[Z,_e]=B(j,[S]),w=S(),[ee,k]=Z(j),ne=e=>{const{__scopeContextMenu:r,children:n,onOpenChange:o,dir:a,modal:d=!0}=e,[i,s]=t.useState(!1),u=w(r),m=F(o),l=t.useCallback(g=>{s(g),m(g)},[m]);return t.createElement(ee,{scope:r,open:i,onOpenChange:l,modal:d},t.createElement(Y,$({},u,{dir:a,open:i,onOpenChange:l,modal:d}),n))},te="ContextMenuTrigger",re=t.forwardRef((e,r)=>{const{__scopeContextMenu:n,disabled:o=!1,...a}=e,d=k(te,n),i=w(n),s=t.useRef({x:0,y:0}),u=t.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...s.current})}),m=t.useRef(0),l=t.useCallback(()=>window.clearTimeout(m.current),[]),g=f=>{s.current={x:f.clientX,y:f.clientY},d.onOpenChange(!0)};return t.useEffect(()=>l,[l]),t.useEffect(()=>void(o&&l()),[o,l]),t.createElement(t.Fragment,null,t.createElement(X,$({},i,{virtualRef:u})),t.createElement(V.span,$({"data-state":d.open?"open":"closed","data-disabled":o?"":void 0},a,{ref:r,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:o?e.onContextMenu:I(e.onContextMenu,f=>{l(),g(f),f.preventDefault()}),onPointerDown:o?e.onPointerDown:I(e.onPointerDown,_(f=>{l(),m.current=window.setTimeout(()=>g(f),700)})),onPointerMove:o?e.onPointerMove:I(e.onPointerMove,_(l)),onPointerCancel:o?e.onPointerCancel:I(e.onPointerCancel,_(l)),onPointerUp:o?e.onPointerUp:I(e.onPointerUp,_(l))})))}),ae=e=>{const{__scopeContextMenu:r,...n}=e,o=w(r);return t.createElement(W,$({},o,n))},oe="ContextMenuContent",ie=t.forwardRef((e,r)=>{const{__scopeContextMenu:n,...o}=e,a=k(oe,n),d=w(n),i=t.useRef(!1);return t.createElement(z,$({},d,o,{ref:r,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:s=>{var u;(u=e.onCloseAutoFocus)===null||u===void 0||u.call(e,s),!s.defaultPrevented&&i.current&&s.preventDefault(),i.current=!1},onInteractOutside:s=>{var u;(u=e.onInteractOutside)===null||u===void 0||u.call(e,s),!s.defaultPrevented&&!a.modal&&(i.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),se=t.forwardRef((e,r)=>{const{__scopeContextMenu:n,...o}=e,a=w(n);return t.createElement(G,$({},a,o,{ref:r}))}),ce=t.forwardRef((e,r)=>{const{__scopeContextMenu:n,...o}=e,a=w(n);return t.createElement(J,$({},a,o,{ref:r}))});function _(e){return r=>r.pointerType!=="mouse"?e(r):void 0}const de=ne,ue=re,le=ae,me=ie,pe=se,fe=ce;function ge(e){return c.jsxs(de,{onOpenChange:e.onOpenChange,children:[c.jsx(ue,{asChild:!0,children:e.children}),c.jsx(le,{children:c.jsx(me,{asChild:!0,children:c.jsx(H,{children:e.content})})})]})}ge.__docgenInfo={description:"",methods:[],displayName:"ContextMenu",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},content:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},open:{required:!1,tsType:{name:"boolean"},description:""},onOpenChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:""}}};function he({children:e,...r}){return c.jsx(pe,{...r,asChild:!0,children:c.jsx(U,{size:"S",rounded:!0,children:e})})}he.__docgenInfo={description:"",methods:[],displayName:"ContextMenuItem"};function ye(){return c.jsx(fe,{className:"context-menu-separator"})}ye.__docgenInfo={description:"",methods:[],displayName:"ContextMenuSeparator"};const L=t.createContext({treeId:null,setIsDragging:()=>{}}),D=t.createContext({map:new Map});var v=(e=>(e[e.Before=0]="Before",e[e.After=1]="After",e[e.Child=2]="Child",e))(v||{});function A(e,r){if(e.id===r)return!0;if(e.children){for(const n of e.children)if(A(n,r))return!0}return!1}function N(e,r,n){const o=e.currentTarget;if(!(o instanceof HTMLElement))return null;const a=o.getBoundingClientRect(),d=e.clientY-a.top,i=d<a.height/3?v.Before:d>a.height*2/3?v.After:v.Child;return A(r,n.id)||n.children===void 0&&i===v.Child?null:i}function xe(e,r,n){const[o,a]=t.useState(!1),[d,i]=t.useState(0),[s,u]=t.useState(0);return{handlePointerDown:t.useMemo(()=>Q({onMove:(l,g,f)=>{if(l.pointerType!=="touch")return l.preventDefault(),f?(a(!0),i(l.pageX),u(l.pageY),!0):(e(),!0)},onUp:()=>{a(!1),r()}}),[e,r]),shadow:o&&K.createPortal(c.jsx("div",{style:{position:"absolute",pointerEvents:"none",display:"flex",left:`${d}px`,top:`${s}px`,opacity:"0.5",boxSizing:"border-box"},children:n}),document.body)}}function P({depth:e=0,updateIndicator:r=N,...n}){var O;const o=n.render,{treeId:a,setIsDragging:d}=t.useContext(L),i=t.useRef(null),{map:s}=t.useContext(D),[u,m]=t.useState(!0),{handlePointerDown:l,shadow:g}=xe(()=>{d(n.item.id)},()=>{},(O=n.shadowRender)==null?void 0:O.call(n,{item:n.item,depth:e,open:!1,onOpenChange:()=>{}})),f=t.useCallback(x=>{var p,C;if(!a)return;const h=s.get(a);if(!h)return;const y=r(x,h.item,n.item);(p=n.onOrderChange)==null||p.call(n,a,n.item.id,y),d(null),i.current&&((C=n.onUpdateIndicator)==null||C.call(n,i.current,null,e))},[e,s,n.item,n.onOrderChange,n.onUpdateIndicator,d,a,r]),M=t.useCallback(x=>{var p;if(console.log("pointerMove"),!a)return;const h=s.get(a);if(!h)return;const y=N(x,h.item,n.item);i.current&&((p=n.onUpdateIndicator)==null||p.call(n,i.current,y,e))},[e,s,n.item,n.onUpdateIndicator,a]),R=t.useMemo(()=>()=>{n.onItemSelect(n.item)},[n.onItemSelect,n.item]);return c.jsxs(c.Fragment,{children:[c.jsxs("li",{onPointerUp:f,onPointerDown:l,onPointerMove:M,ref:i,className:"cmpui_tree-view__item",onClick:R,children:[c.jsx(o,{item:n.item,onOpenChange:m,open:u,depth:e}),g]}),n.item.children&&u&&c.jsx("li",{className:"cmpui_tree-view__item-dir",children:c.jsx("ol",{className:"cmpui_tree-view__item-dir-ol",children:n.item.children.map(x=>c.jsx(P,{updateIndicator:r,render:n.render,shadowRender:n.shadowRender,onOrderChange:n.onOrderChange,onUpdateIndicator:n.onUpdateIndicator,depth:e+1,item:x,isSelected:n.isSelected,onItemSelect:n.onItemSelect},x.id))})})]})}P.__docgenInfo={description:"",methods:[],displayName:"TreeViewItem",props:{depth:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"0",computed:!1}},isSelected:{required:!0,tsType:{name:"boolean"},description:""},item:{required:!0,tsType:{name:"T"},description:""},onItemSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: T) => void",signature:{arguments:[{type:{name:"T"},name:"item"}],return:{name:"void"}}},description:""},onOrderChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(src: string, dist: string, type: OrderType | null) => void",signature:{arguments:[{type:{name:"string"},name:"src"},{type:{name:"string"},name:"dist"},{type:{name:"union",raw:"OrderType | null",elements:[{name:"OrderType"},{name:"null"}]},name:"type"}],return:{name:"void"}}},description:""},onUpdateIndicator:{required:!1,tsType:{name:"signature",type:"function",raw:`(
  el: HTMLLIElement,
  type: OrderType | null,
  depth: number,
) => void`,signature:{arguments:[{type:{name:"HTMLLIElement"},name:"el"},{type:{name:"union",raw:"OrderType | null",elements:[{name:"OrderType"},{name:"null"}]},name:"type"},{type:{name:"number"},name:"depth"}],return:{name:"void"}}},description:""},render:{required:!0,tsType:{name:"signature",type:"function",raw:"(props: RenderProps<T>) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  depth: number;
  item: T;
  onOpenChange: (isOpen: boolean) => void;
  open: boolean;
}`,signature:{properties:[{key:"depth",value:{name:"number",required:!0}},{key:"item",value:{name:"T",required:!0}},{key:"onOpenChange",value:{name:"signature",type:"function",raw:"(isOpen: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"isOpen"}],return:{name:"void"}},required:!0}},{key:"open",value:{name:"boolean",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:""},shadowRender:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: RenderProps<T>) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  depth: number;
  item: T;
  onOpenChange: (isOpen: boolean) => void;
  open: boolean;
}`,signature:{properties:[{key:"depth",value:{name:"number",required:!0}},{key:"item",value:{name:"T",required:!0}},{key:"onOpenChange",value:{name:"signature",type:"function",raw:"(isOpen: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"isOpen"}],return:{name:"void"}},required:!0}},{key:"open",value:{name:"boolean",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:""},updateIndicator:{required:!1,tsType:{name:"signature",type:"function",raw:`(
  e: React.PointerEvent<HTMLLIElement>,
  srcItem: ITree,
  distItem: ITree,
) => OrderType | null`,signature:{arguments:[{type:{name:"ReactPointerEvent",raw:"React.PointerEvent<HTMLLIElement>",elements:[{name:"HTMLLIElement"}]},name:"e"},{type:{name:"signature",type:"object",raw:`{
  id: string;
  children?: ITree[];
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"children",value:{name:"Array",elements:[{name:"ITree"}],raw:"ITree[]",required:!1}}]}},name:"srcItem"},{type:{name:"signature",type:"object",raw:`{
  id: string;
  children?: ITree[];
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"children",value:{name:"Array",elements:[{name:"ITree"}],raw:"ITree[]",required:!1}}]}},name:"distItem"}],return:{name:"union",raw:"OrderType | null",elements:[{name:"OrderType"},{name:"null"}]}}},description:"",defaultValue:{value:`function defaultIndicatorUpdate(
  e: React.PointerEvent<HTMLLIElement>,
  srcItem: ITree,
  distItem: ITree,
): OrderType | null {
  const el = e.currentTarget;
  if (!(el instanceof HTMLElement)) return null;
  const rect = el.getBoundingClientRect();
  const y = e.clientY - rect.top;

  const orderType =
    y < rect.height / 3
      ? OrderType.Before
      : y > (rect.height * 2) / 3
        ? OrderType.After
        : OrderType.Child;

  if (inChildren(srcItem, distItem.id)) {
    return null;
  }

  if (distItem.children === undefined && orderType === OrderType.Child) {
    return null;
  }

  return orderType;
}`,computed:!1}}}};function be(e){const[r,n]=t.useState(null),[o,a]=t.useState(null),d=t.useMemo(()=>{const h=new Map,y=(p,C)=>{var b;h.set(p.id,{item:p,parentId:C}),(b=p.children)==null||b.forEach(T=>y(T,p.id))};return e.items.forEach(p=>y(p)),h},[e.items]),[i,s]=t.useState(0),[u,m]=t.useState(0),[l,g]=t.useState(0),[f,M]=t.useState(0),[R,O]=t.useState(null),x=t.useRef(null);return c.jsx(D.Provider,{value:{map:d},children:c.jsx(L.Provider,{value:{treeId:o,setIsDragging:a},children:c.jsxs("div",{className:"cmpui_tree-view__root",ref:x,children:[c.jsx("ol",{className:"cmpui_tree-view__ol",children:e.items.map(h=>c.jsx(P,{item:h,isSelected:r===h,onItemSelect:y=>{n(y)},shadowRender:e.shadowRender,render:e.render,onOrderChange:e.onOrderChange,updateIndicator:e.updateIndicator,onUpdateIndicator:(y,p,C)=>{var q;const b=(q=x.current)==null?void 0:q.getBoundingClientRect();if(!b)return;const T=y.getBoundingClientRect(),E=C*8;s(E),M(b.width-E-8),p===v.Child?(m(T.top-b.top),g(T.height)):p===v.Before?(m(T.top-b.top),g(4)):(m(T.top-b.top+T.height-4),g(4)),O(p)}},h.id))}),R!==null&&c.jsx("div",{className:"cmpui_tree-view__drag-indicator","data-order":R,style:{left:i,top:u,width:f,height:l}})]})})})}be.__docgenInfo={description:"",methods:[],displayName:"TreeView",props:{items:{required:!0,tsType:{name:"Array",elements:[{name:"T"}],raw:"T[]"},description:""},onOrderChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(src: string, dist: string, type: OrderType | null) => void",signature:{arguments:[{type:{name:"string"},name:"src"},{type:{name:"string"},name:"dist"},{type:{name:"union",raw:"OrderType | null",elements:[{name:"OrderType"},{name:"null"}]},name:"type"}],return:{name:"void"}}},description:""},render:{required:!0,tsType:{name:"signature",type:"function",raw:"(props: RenderProps<T>) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  depth: number;
  item: T;
  onOpenChange: (isOpen: boolean) => void;
  open: boolean;
}`,signature:{properties:[{key:"depth",value:{name:"number",required:!0}},{key:"item",value:{name:"T",required:!0}},{key:"onOpenChange",value:{name:"signature",type:"function",raw:"(isOpen: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"isOpen"}],return:{name:"void"}},required:!0}},{key:"open",value:{name:"boolean",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:""},shadowRender:{required:!1,tsType:{name:"signature",type:"function",raw:"(props: RenderProps<T>) => React.ReactNode",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  depth: number;
  item: T;
  onOpenChange: (isOpen: boolean) => void;
  open: boolean;
}`,signature:{properties:[{key:"depth",value:{name:"number",required:!0}},{key:"item",value:{name:"T",required:!0}},{key:"onOpenChange",value:{name:"signature",type:"function",raw:"(isOpen: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"isOpen"}],return:{name:"void"}},required:!0}},{key:"open",value:{name:"boolean",required:!0}}]}},name:"props"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:""},updateIndicator:{required:!1,tsType:{name:"signature",type:"function",raw:`(
  e: React.PointerEvent<HTMLLIElement>,
  srcItem: ITree,
  distItem: ITree,
) => OrderType | null`,signature:{arguments:[{type:{name:"ReactPointerEvent",raw:"React.PointerEvent<HTMLLIElement>",elements:[{name:"HTMLLIElement"}]},name:"e"},{type:{name:"signature",type:"object",raw:`{
  id: string;
  children?: ITree[];
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"children",value:{name:"Array",elements:[{name:"ITree"}],raw:"ITree[]",required:!1}}]}},name:"srcItem"},{type:{name:"signature",type:"object",raw:`{
  id: string;
  children?: ITree[];
}`,signature:{properties:[{key:"id",value:{name:"string",required:!0}},{key:"children",value:{name:"Array",elements:[{name:"ITree"}],raw:"ITree[]",required:!1}}]}},name:"distItem"}],return:{name:"union",raw:"OrderType | null",elements:[{name:"OrderType"},{name:"null"}]}}},description:""}}};export{ge as C,v as O,be as T,he as a,ye as b,Q as c,A as i};
